# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é —Ç–æ–∫–µ–Ω–∞ Moodle –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

> üìñ **–í–∞–∂–Ω–æ:** –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ [–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–∫–µ–Ω Moodle](MOODLE_TOKEN_HOW_IT_WORKS.md) - —Ç–∞–º –æ–±—ä—è—Å–Ω—è–µ—Ç—Å—è, –ø–æ—á–µ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–¥–∏–Ω —Ç–æ–∫–µ–Ω –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç.

## –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –í–∫–ª—é—á–µ–Ω–∏–µ –≤–µ–±-—Å–µ—Ä–≤–∏—Å–æ–≤

1. –í–æ–π–¥–∏—Ç–µ –≤ Moodle –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **Site administration** ‚Üí **Advanced features**
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≥–∞–ª–æ—á–∫—É **Enable web services**
4. –ù–∞–∂–º–∏—Ç–µ **Save changes**

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ REST

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **Site administration** ‚Üí **Plugins** ‚Üí **Web services** ‚Üí **Manage protocols**
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–æ—Ç–æ–∫–æ–ª **REST** –≤–∫–ª—é—á–µ–Ω (–≥–∞–ª–æ—á–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞)
3. –ï—Å–ª–∏ REST –Ω–µ –≤–∫–ª—é—á–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≥–∞–ª–æ—á–∫—É –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ

### –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ (External Service)

–î–ª—è —Ç–æ–∫–µ–Ω–∞ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **Site administration** ‚Üí **Plugins** ‚Üí **Web services** ‚Üí **External services**
2. –ù–∞–∂–º–∏—Ç–µ **Add** (–î–æ–±–∞–≤–∏—Ç—å)
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
   - **Name**: `Full Access API` (–∏–ª–∏ –ª—é–±–æ–µ –¥—Ä—É–≥–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ)
   - **Short name**: `full_access_api` (—É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∫–æ—Ä–æ—Ç–∫–æ–µ –∏–º—è)
   - **Enabled**: ‚úÖ (–≤–∫–ª—é—á–µ–Ω–æ)
   - **Required capability**: –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º (–¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞)
   - **Restricted users**: ‚ùå (–Ω–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
   - **Download files**: ‚úÖ (—Ä–∞–∑—Ä–µ—à–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤)
   - **Upload files**: ‚úÖ (—Ä–∞–∑—Ä–µ—à–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤)
4. –ù–∞–∂–º–∏—Ç–µ **Save changes**

### –®–∞–≥ 4: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –≤ —Å–µ—Ä–≤–∏—Å

1. –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –µ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏–µ
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Functions** (–§—É–Ω–∫—Ü–∏–∏)
3. –ù–∞–∂–º–∏—Ç–µ **Add functions** (–î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏)
4. –í –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –≤–≤–µ–¥–∏—Ç–µ `mod_assign_get_assignments` –∏ –¥–æ–±–∞–≤—å—Ç–µ
5. –î–æ–±–∞–≤—å—Ç–µ –¥—Ä—É–≥–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
   - `mod_quiz_get_quizzes_by_courses`
   - `mod_quiz_get_user_attempts`
   - `mod_quiz_get_user_best_grade`
   - `mod_forum_get_forums_by_courses`
   - `mod_forum_get_forum_discussions`
   - `mod_forum_get_discussion_posts`
   - `core_course_get_contents`
   - `core_course_get_courses`
   - `core_enrol_get_enrolled_users`
   - `core_user_get_users_by_field`
   - `core_webservice_get_site_info`
   - –ò –¥—Ä—É–≥–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

**–ò–ª–∏ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:**
- –í –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –≤–≤–µ–¥–∏—Ç–µ `*` (–∑–≤–µ–∑–¥–æ—á–∫–∞) –∏ –Ω–∞–∂–º–∏—Ç–µ –ø–æ–∏—Å–∫
- –í—ã–±–µ—Ä–∏—Ç–µ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "Select all"
- –ù–∞–∂–º–∏—Ç–µ **Add functions**

### –®–∞–≥ 5: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Ç–æ–∫–µ–Ω–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ª—É—á—à–µ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è API:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **Site administration** ‚Üí **Users** ‚Üí **Accounts** ‚Üí **Add a new user**
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:
   - **Username**: `api_user` (–∏–ª–∏ –¥—Ä—É–≥–æ–µ –∏–º—è)
   - **Password**: —Å–æ–∑–¥–∞–π—Ç–µ –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å
   - **First name**: `API`
   - **Surname**: `User`
   - **Email**: `api@yourdomain.com`
3. –ù–∞–∂–º–∏—Ç–µ **Create user**

### –®–∞–≥ 6: –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **Site administration** ‚Üí **Users** ‚Üí **Permissions** ‚Üí **Assign system roles**
2. –ù–∞–π–¥–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è API –∏ –Ω–∞–∑–Ω–∞—á—å—Ç–µ –µ–º—É —Ä–æ–ª—å **Manager** (–ú–µ–Ω–µ–¥–∂–µ—Ä)
   - –≠—Ç–æ –¥–∞—Å—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –Ω–∞ –≤—Å–µ—Ö –∫—É—Ä—Å–∞—Ö

**–ò–ª–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∫—É—Ä—Å–∞–º:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω—É–∂–Ω—ã–π –∫—É—Ä—Å
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **Participants** ‚Üí **Enrol users**
3. –ù–∞–π–¥–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è API –∏ –∑–∞—á–∏—Å–ª–∏—Ç–µ –µ–≥–æ —Å —Ä–æ–ª—å—é **Manager** –∏–ª–∏ **Course creator**

### –®–∞–≥ 7: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **Site administration** ‚Üí **Plugins** ‚Üí **Web services** ‚Üí **Manage tokens**
2. –ù–∞–∂–º–∏—Ç–µ **Create token** (–°–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω)
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
   - **User**: –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è API (—Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –Ω–∞ —à–∞–≥–µ 5)
   - **Service**: –≤—ã–±–µ—Ä–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å "Full Access API"
   - **IP restriction**: –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º (–¥–ª—è –¥–æ—Å—Ç—É–ø–∞ —Å –ª—é–±–æ–≥–æ IP)
   - **Valid until**: –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º (—Ç–æ–∫–µ–Ω –±–µ–∑ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è)
4. –ù–∞–∂–º–∏—Ç–µ **Save changes**
5. **–í–ê–ñ–ù–û**: –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω —Å—Ä–∞–∑—É - –æ–Ω –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω!

### –®–∞–≥ 8: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Laravel

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ Laravel
2. –û–±–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
   ```
   MOODLE_URL=https://class.russianseminary.org
   MOODLE_TOKEN=–≤–∞—à_–Ω–æ–≤—ã–π_—Ç–æ–∫–µ–Ω_–∑–¥–µ—Å—å
   ```
3. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à Laravel:
   ```bash
   php artisan config:clear
   php artisan cache:clear
   ```

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±: –¢–æ–∫–µ–Ω –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞):

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç —Ä–æ–ª—å **Manager** –∏–ª–∏ **Administrator** –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–∏—Å—Ç–µ–º—ã
2. –°–æ–∑–¥–∞–π—Ç–µ —Ç–æ–∫–µ–Ω –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—à–∞–≥ 7)
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—á–∏—Å–ª–µ–Ω –Ω–∞ –≤—Å–µ –Ω—É–∂–Ω—ã–µ –∫—É—Ä—Å—ã

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –µ–≥–æ —Ä–∞–±–æ—Ç—É:

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É `/admin/settings` –≤ Laravel
2. –í —Å–µ–∫—Ü–∏–∏ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Moodle" –¥–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–∫–µ–Ω–µ
3. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç–∞—Ç—É—Å "–¢–æ–∫–µ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ"
4. –î–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ —Ç–æ–∫–µ–Ω–∞

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ "User is not enrolled or does not have requested capability"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ó–∞–π–¥–∏—Ç–µ –≤ Moodle –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Ç–æ–∫–µ–Ω–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –Ω—É–∂–Ω—ã–µ –∫—É—Ä—Å—ã
3. –ï—Å–ª–∏ –∫—É—Ä—Å—ã –Ω–µ –≤–∏–¥–Ω—ã, –∑–∞—á–∏—Å–ª–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –∫—É—Ä—Å—ã —Å —Ä–æ–ª—å—é "Manager" –∏–ª–∏ "Course creator"
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ —Ä–æ–ª–∏: **Site administration** ‚Üí **Users** ‚Üí **Permissions** ‚Üí **Define roles**
5. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–æ–ª—å –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞:
   - `mod/assign:view`
   - `mod/quiz:view`
   - `mod/forum:view`
   - `moodle/course:view`

### –¢–æ–∫–µ–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. –¢–æ–∫–µ–Ω —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é (–±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤)
2. URL Moodle —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ (—Å `https://`)
3. –í–µ–±-—Å–µ—Ä–≤–∏—Å—ã –≤–∫–ª—é—á–µ–Ω—ã –≤ Moodle
4. –ü—Ä–æ—Ç–æ–∫–æ–ª REST –≤–∫–ª—é—á–µ–Ω
5. –¢–æ–∫–µ–Ω –Ω–µ –∏—Å—Ç–µ–∫ (–µ—Å–ª–∏ –±—ã–ª —É–∫–∞–∑–∞–Ω —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è)

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ:**
- –¢–æ–∫–µ–Ω –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –¥–∞–µ—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ Moodle API
- –•—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (—Ñ–∞–π–ª `.env` –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –ø—É–±–ª–∏—á–Ω–æ)
- –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —Ñ–∞–π–ª `.env` –≤ git
- –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ Moodle –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è API, –∞ –Ω–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
